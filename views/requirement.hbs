<div class="content px-3">
    {{>navigation}}

        <div class="container mx-auto bg-white py-3 h-100 w-100 mb-2">
          <nav
            class="navbar navbar-expand-lg bg-body-tertiary"
            style="border-radius: 0.25rem"
          >
            <div class="container-fluid d-flex justify-content-between">
              <div class="left-side">
                <h6 class="mb-0" id="requirement-h">
                  Requirements
                  <span class="ml-2 count-box">{{project.requirementCount}}</span>
                </h6>
              </div>
              <div class="right-side">
                <a href="#" class="guide mx-2 text-dark">
                  <div
                    class="text-center d-flex flex-column align-items-center"
                  >
                    <img
                      src="/images/guide.png"
                      alt=""
                      style="width: 2rem"
                    />
                    <span>Guide</span>
                  </div>
                </a>
                <a
                  href="/project/{{project.ProjectID}}/requirement/import/"
                  title="Import"
                  class="mr-3 d-flex align-items-center text-dark"
                >
                  <i class="bi bi-cloud-upload"></i>
                  <div class="ps-1">Import</div>
                </a>
                <a
                  href="#"
                  title="Archived Requirement Type"
                  class="mr-3 d-flex align-items-center text-dark"
                >
                  <i class="bi bi-archive"></i>
                  <div class="ps-1">Archived</div>
                </a>
                <button
                  type="button"
                  class="btn btn-danger btn-graph px-3 my-auto"
                  data-bs-toggle="modal"
                  data-bs-target="#addRequirementType"
                  style="width: 13rem"
                >
                  Add Requirement Type
                </button>
              </div>
            </div>
          </nav>
          <div class="d-flex mt-3 justify-content-between w-100">
            <div class="col-3 h-100 modules-card border border-0">
              <div class="card border-0" style="min-height: 400px">
                <div class="card-header d-flex justify-content-between">
                  <h6 class="my-auto">Requirement Type</h6>
                  <div>
                    <button
                      type="button"
                      class="btn btn-outline-secondary border-0 py-0 px-1"
                    >
                      <i class="fs-5 bi bi-plus"></i>
                    </button>
                    <button
                      type="button"
                      class="btn btn-outline-secondary border-0 py-0 px-1"
                      id="toggleButtonModules"
                    >
                      <i class="bi bi-arrow-right" id="toggleIconModules"></i>
                    </button>
                  </div>
                </div>
                <div class="card-body" style="background-color: #f8f9fa">
                  <form action="" class="search-requirementType">
                    <input
                      class="form-control mb-2"
                      type="text"
                      name="requirementTypeKeyword"
                      placeholder="Type To Filter Requirement Type"
                      aria-label="default input example"
                    />
                  </form>

                  <script>
                          document.addEventListener('DOMContentLoaded', function() {
                              const form = document.querySelector('.search-requirementType');
                              form.addEventListener('submit', function(event) {
                                  event.preventDefault(); 
                                  const keyword = document.querySelector('input[name="requirementTypeKeyword"]').value;
                                  const currentUrl = new URL(window.location.href);
                                  currentUrl.searchParams.set('requirementTypeKeyword', keyword);
                                  window.location.href = currentUrl.toString();
                              });
                          });
                      </script>
                  
                  {{#each project.RequirementTypes}}
                    <div class="d-flex py-2">
                        <input
                            class="form-check-input ms-4 me-2 checkbox-RequirementTypes-item"
                            type="checkbox"
                            value="{{ this }}"
                            id="checkbox-RequirementTypes-item-{{@index}}"
                        />
                        <div class="d-flex">
                            <i class="bi bi-folder text-primary me-2"></i>
                            <div>{{ this }}</div>
                        </div>
                    </div>
                {{/each}}

                <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const checkboxes = document.querySelectorAll('.checkbox-RequirementTypes-item');

                    // Kiểm tra URL hiện tại để lấy RequirementTypes
                    const currentUrl = new URL(window.location.href);
                    const selectedTypes = currentUrl.searchParams.get('RequirementTypes');
                    const selectedTypesArray = selectedTypes ? selectedTypes.split(',') : [];

                    // Tick sẵn các checkbox tương ứng
                    checkboxes.forEach(checkbox => {
                        if (selectedTypesArray.includes(checkbox.value)) {
                            checkbox.checked = true;
                        }
                    });

                    // Thêm sự kiện thay đổi cho các checkbox
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function() {
                            const selectedTypes = [];
                            checkboxes.forEach(cb => {
                                if (cb.checked) {
                                    selectedTypes.push(cb.value);
                                }
                            });

                            if (selectedTypes.length > 0) {
                                currentUrl.searchParams.set('RequirementTypes', selectedTypes.join(','));
                            } else {
                                currentUrl.searchParams.delete('RequirementTypes');
                            }

                            window.location.href = currentUrl.toString();
                        });
                    });
                });
                </script>



      
                </div>
                {{!-- <script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('.form-check-input');
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const selectedTypes = [];
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    selectedTypes.push(cb.value);
                }
            });

            const currentUrl = new URL(window.location.href);
            if (selectedTypes.length > 0) {
                currentUrl.searchParams.set('RequirementTypes', selectedTypes.join(','));
            } else {
                currentUrl.searchParams.delete('RequirementTypes');
            }

            window.location.href = currentUrl.toString();
        });
    });
});
</script> --}}
              </div>
            </div>
            <div
              class="col-1 d-flex my-auto"
              style="margin-left: -1rem; z-index: 1000; width: 20px"
            >
              <a href="#" id="toggleButtonModulesRequirement">
                <div
                  class="rounded bg-success d-flex text-white"
                  style="width: 30px; height: 40px"
                >
                  <i
                    class="bi bi-chevron-compact-left m-auto"
                    id="toggleIconModulesRequirement"
                  ></i>
                </div>
              </a>
            </div>
            <div class="col-9 test-cases-card ps-3 border border-0">
              <div class="card bg-body-tertiary h-100 border border-0">
                <div class="card-header">
                  <div class="row">
                    <div class="col-3 d-flex align-items-center">
                      <div>Total</div>
                      <div class="bg-danger-subtle px-2 mx-2 rounded">
                        <span class="text-danger">{{project.Requirements.length}}</span>
                      </div>
                      <a href="#" class="ms-3"><i class="bi bi-pencil"></i></a>
                    </div>
                    <div class="row col-9 ms-auto my-auto align-items-center">
                      <div class="col-4">
                        <input
                          list="brow-module"
                          placeholder="Select an Assigned To"
                          class="form-select border-0 bg-light"
                          id="assignedToInput"
                          onchange="handleChange(this.value)"
                        />
                        <datalist id="brow-module">
                          {{#each project.Users}}
                          <option value="{{Name}}"></option>
                          {{/each}}
                        </datalist>
                        <script>
                          function handleChange(selectedValue) {
                          // Lấy đường dẫn hiện tại
                          const currentUrl = new URL(window.location.href);

                          // Thêm giá trị đã chọn vào đường dẫn hiện tại
                          currentUrl.searchParams.set('assignedTo', selectedValue);

                          // Chuyển hướng đến đường dẫn mới
                          window.location.href = currentUrl.toString();
                      }
                      </script>
                      </div>
                      <div class="col-3">
                        <form action="" class="search-requirement">
                          <input
                            class="form-control"
                            type="text"
                            name="requirementKeyword"
                            placeholder="Search By Description"
                            aria-label="default input example"
                          />
                        </form>
                        <script>
                          document.addEventListener('DOMContentLoaded', function() {
                              const form = document.querySelector('.search-requirement');
                              form.addEventListener('submit', function(event) {
                                  event.preventDefault(); 
                                  const keyword = document.querySelector('input[name="requirementKeyword"]').value;
                                  const currentUrl = new URL(window.location.href);
                                  currentUrl.searchParams.set('requirementKeyword', keyword);
                                  window.location.href = currentUrl.toString();
                              });
                          });
                      </script>
                      </div>
                      <div class="col-5 d-flex justify-content-between fs-6">
                        <a href="#" title="Add" class="my-auto fs-4 text-dark"
                          ><i class="bi bi-plus"></i
                        ></a>
                        <a
                          href="#"
                          title="Archived Requirement Type"
                          class="my-auto d-flex justify-content-between text-dark align-items-center"
                        >
                          <i class="bi bi-archive"></i>
                          <p class="mb-0 ps-2">Archived</p>
                        </a>
                        <a
                          href="#"
                          title="Export"
                          class="my-auto d-flex justify-content-between text-dark align-items-center"
                        >
                          <i class="bi bi-cloud-download"></i>
                          <p class="mb-0 ps-2">Export</p>
                        </a>
                        <a
                          href="#"
                          title="Remove"
                          class="my-auto text-dark pe-2"
                          ><i class="bi bi-trash"></i
                        ></a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <div class="above d-flex justify-content-between">
                    <div class="w-25 d-flex">
                      <span class="my-auto">Show</span>
                      <select
                        class="form-select mx-2 my-auto"
                        style="
                          background-color: #f5f5f5;
                          height: 2.5rem;
                          width: 6rem;
                        "
                        aria-label="Default select example"
                      >
                        <option selected>10</option>
                        <option value="1">20</option>
                        <option value="2">30</option>
                        <option value="3">50</option>
                        <option value="3">100</option>
                      </select>
                      <span class="my-auto" style="font-size: medium"
                        >entries</span
                      >
                    </div>
                    <div class="d-flex">
                      <div class="mx-2 d-flex">
                          <span class="my-auto">Sort</span>
                          <form action="" method="GET" class="mx-2 d-flex bg-white rounded" id="form-sort">
                              <select
                                  name="sortField"
                                  class="form-select border-0 rounded-0 rounded-start"
                                  aria-label="Default select example"
                                  style="width: 10rem"
                              >
                                  <option value="created-date" {{#if (eq project.sortField 'created-date')}}selected{{/if}}>Created date</option>
                                  <option value="title" {{#if (eq project.sortField 'title')}}selected{{/if}}>Description</option>
                                  <option value="case-code" {{#if (eq project.sortField 'case-code')}}selected{{/if}}>Code</option>
                              </select>
                              <select
                                  name="sortOrder"
                                  class="form-select border-0 rounded-0 ms-1 rounded-end"
                                  aria-label="Default select example"
                                  style="width: 7rem"
                              >
                                  <option value="desc" {{#if (eq project.sortOrder 'desc')}}selected{{/if}}>Desc</option>
                                  <option value="asc" {{#if (eq project.sortOrder 'asc')}}selected{{/if}}>Asc</option>
                              </select>
                          </form>
                      </div>


                      <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const sortForm = document.getElementById('form-sort');
                            const sortFields = sortForm.querySelectorAll('select');

                            sortFields.forEach(select => {
                                select.addEventListener('change', function() {
                                    // Lấy URL hiện tại
                                    const currentUrl = new URL(window.location.href);
                                    
                                    // Lấy các tham số hiện tại từ URL
                                    const params = new URLSearchParams(currentUrl.search);

                                    // Cập nhật các tham số sắp xếp
                                    sortFields.forEach(field => {
                                        params.set(field.name, field.value);
                                    });

                                    // Tạo URL mới với các tham số đã cập nhật
                                    const newUrl = `${currentUrl.pathname}?${params.toString()}`;

                                    // Chuyển hướng đến URL mới
                                    window.location.href = newUrl;
                                });
                            });
                        });
                      </script>


                      <div class="d-flex my-auto justify-content-end">
                        <button
                          class="rounded-circle bg-dark-subtle d-flex mx-1 border-0"
                          style="width: 2rem; height: 2rem"
                        >
                          <i class="bi bi-chevron-compact-left m-auto"></i>
                        </button>
                        <button
                          class="rounded-circle bg-danger d-flex mx-1 border-0"
                          style="width: 2rem; height: 2rem"
                        >
                          <span class="m-auto">1</span>
                        </button>
                        <button
                          class="rounded-circle bg-dark-subtle d-flex mx-1 border-0"
                          style="width: 2rem; height: 2rem"
                        >
                          <i class="bi bi-chevron-compact-right m-auto"></i>
                        </button>
                      </div>
                    </div>
                  </div>

                  <div class="below">
                    <table class="table">
                      <thead>
                        <tr>
                          <td scope="col" class="bg-body-tertiary">
                            <div class="form-check">
                              <input
                                class="form-check-input"
                                type="checkbox"
                                value=""
                                id="case-code"
                                onchange="toggleCheckAllRequirement(this)"
                              />
                              <label class="form-check-label" for="case-code"
                                >Requirement Code</label
                              >
                            </div>
                          </td>
                          <td scope="col" class="bg-body-tertiary">Description</td>
                          <td scope="col" class="bg-body-tertiary text-center">
                            Actions
                          </td>
                        </tr>
                      </thead>
                      <tbody>
                        {{#each project.Requirements}}
                        <tr>
                            <td scope="col" class="bg-body-tertiary align-middle">
                                <div class="form-check">
                                    <input
                                        class="form-check-input code-requirement-item"
                                        type="checkbox"
                                        value=""
                                        id="code-requirement-item"
                                    />
                                    <label class="form-check-label" for="code-requirement-item">{{truncateId this._id 0}}</label>
                                </div>
                            </td>
                            <td scope="col" class="bg-body-tertiary align-middle">
                                <a href="#">{{this.Description}}</a>
                            </td>
                            <td scope="col" class="bg-body-tertiary align-middle">
                                <div class="d-flex justify-content-end text-dark">
                                    <a href="#" class="mx-2 my-auto text-dark" title="View"><i class="bi bi-eye"></i></a>
                                    <a href="#" class="mx-2 my-auto text-primary" title="Edit"><i class="bi bi-pencil"></i></a>
                                    <a href="#" class="mx-2 my-auto text-dark" title="Clone"><i class="bi bi-copy"></i></a>
                                    <a href="#" class="mx-2 my-auto text-dark fs-5" title="Link Testcase"><i class="bi bi-link-45deg"></i></a>
                                    <a href="#" data-bs-toggle="tooltip" title="Timesheet" class="mx-2 my-auto text-dark"><i class="bi bi-clock"></i></a>
                                    <a href="#" data-bs-toggle="tooltip" title="Delete" class="mx-2 my-auto text-danger"><i class="bi bi-trash"></i></a>
                                </div>
                            </td>
                        </tr>
                        {{/each}}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <form action="" class="needs-validation" novalidate>
          <div
            class="modal fade"
            id="addRequirementType"
            tabindex="-1"
            aria-labelledby="addModuleLabel"
            aria-hidden="true"
          >
            <div
              class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
            >
              <div
                class="modal-content border border-1 rounded-2"
                style="color: #919faf"
              >
                <div class="modal-header">
                  <div
                    class="modal-title fs-5 fw-semibold text-dark w-100 text-center"
                    id="addTestPlanLabel"
                  >
                    Add Requirement Type
                  </div>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="mb-4">
                    <label
                      for="brow-release"
                      class="form-label d-flex justify-content-between"
                    >
                      <div>Select Release</div>
                    </label>
                    <input
                      list="brow-release"
                      placeholder="Select a Release"
                      class="form-select border-0 bg-light"
                    />
                    <datalist id="brow-release">
                      <option value="Web 7 ver 1.0"></option>
                    </datalist>
                  </div>
                  <div class="mb-4">
                    <label
                      for="brow-requirement-type"
                      class="form-label d-flex justify-content-between"
                    >
                      <div>Select Requirement Type</div>
                    </label>
                    <input
                      list="brow-requirement-type"
                      placeholder=""
                      class="form-select border-0 bg-light"
                    />
                    <datalist id="brow-requirement-type">
                      <option value="Shopping Cart"></option>
                      <option value="Login"></option>
                    </datalist>
                  </div>
                  <div class="mb-4">
                    <label
                      for="form-requirement-type"
                      class="form-label d-flex justify-content-between"
                    >
                      <div>
                        Requirement Type
                        <span style="color: #f44336">*</span>
                      </div>
                    </label>
                    <input
                      type="text"
                      class="form-control bg-light"
                      id="form-requirement-type"
                      placeholder="Please Enter Requirement Type"
                      style="color: #757575"
                      required
                    />
                    <div class="invalid-feedback">
                      Please Enter Your Requirement Type.
                    </div>
                  </div>
                  <div class="mb-2">
                    <label
                      for="form-test-plan-name"
                      class="form-label d-flex justify-content-between"
                    >
                      <div for="RequirementDescription" class="form-label">
                        Requirement Type Description
                      </div>
                    </label>
                    <div class="rounded-top border d-flex p-2 bg-light">
                      <button type="button" class="bg-light border-0 mx-1">
                        <i class="bi bi-type-bold"></i>
                      </button>
                      <button type="button" class="bg-light border-0 mx-1">
                        <i class="bi bi-type-italic"></i>
                      </button>
                      <button type="button" class="bg-light border-0 mx-1">
                        <i class="bi bi-link"></i>
                      </button>
                      <select
                        class="form-select border-0 bg-light"
                        aria-label="Default select example"
                        style="width: 8rem"
                      >
                        <option selected>Normal</option>
                        <option value="1">Small</option>
                        <option value="2">Normal</option>
                        <option value="3">Large</option>
                      </select>
                      <button type="button" class="bg-light border-0 mx-1">
                        <i class="bi bi-list-ol"></i>
                      </button>
                      <button type="button" class="bg-light border-0 mx-1">
                        <i class="bi bi-list-ul"></i>
                      </button>
                    </div>
                    <textarea
                      class="form-control rounded-top-0 bg-light"
                      id="RequirementDescription"
                      rows="4"
                      name="testplan-description"
                      placeholder="Please Enter Requirement Type Description"
                    ></textarea>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-danger mx-2">
                    Save
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-danger mx-2"
                    data-bs-dismiss="modal"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>